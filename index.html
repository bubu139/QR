<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="App.css">
    <title>CVT AI - Gi·∫£i To√°n THPT</title>
    <script src="https://kit.fontawesome.com/8f62b2625c.js" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out',
                    }
                }
            }
        }
    </script>
     <script>
        window.MathJax = { 
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']], 
                displayMath: [['$$', '$$'], ['\\[', '\\]']], 
                processEscapes: true 
            }, 
            options: { 
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] 
            } 
        }; 
    //     var params = {
    //         "appName": "graphing", 
    //         "width": 800, 
    //         "height": 600, 
    //         "showToolBar": true, 
    //         "showAlgebraInput": true, 
    //         "showMenuBar": true,
    //         };
    // var ggbApplet = new GGBApplet(params, true);
    // window.addEventListener("load", function() { 
    //     ggbApplet.inject('ggb-element');
    // });
    </script>
 
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-100 flex items-center justify-center p-2 sm:p-4">
    <div id="ggb-element"></div>

    <div class="w-full max-w-4xl h-[calc(100vh-1rem)] sm:h-[700px] bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-blue-100">
        
        <!-- Header -->
        
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-4 sm:px-6 py-4 sm:py-5 flex items-center gap-3 sm:gap-4 shadow-lg">
            <div class="relative">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-full flex items-center justify-center shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot w-7 h-7 text-blue-500">
                <path d="M12 8V4H8"></path>
                <rect width="16" height="12" x="4" y="8" rx="2"></rect>
                <path d="M2 14h2"></path>
                <path d="M20 14h2"></path>
                <path d="M15 13v2"></path>
                <path d="M9 13v2"></path>
            </svg>
                </div>
                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
            </div>
            <div class="flex-1 min-w-0">
                <h1 class="text-lg sm:text-xl font-bold text-white truncate">üìö CVT AI - Gi·∫£i To√°n THPT</h1>
                <p class="text-blue-100 text-xs sm:text-sm flex items-center gap-1">
                    <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                    ƒêang ho·∫°t ƒë·ªông
                </p>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles w-6 h-6 text-orange-200 animate-pulse"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3">
                        <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path>
                        <path d="M20 3v4"></path>
                        <path d="M22 5h-4"></path>
                        <path d="M4 17v2"></path>
                        <path d="M5 18H3"></path>
                        
                        
                        
                        </svg>
        </div>

        <!-- Messages Container -->
        <div class="flex-1 overflow-y-auto px-4 sm:px-6 py-4 sm:py-6 space-y-3 sm:space-y-4 bg-gradient-to-b from-white to-blue-50 scrollbar-hide" id="messages-container">
            <!-- Messages will be inserted here -->
            <!--<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot w-6 h-6 text-white"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><svg d="M9 13v2">
                <path d="M12 8V4H8"></path>
                <rect width="16" height="12" x="4" y="8" rx="2"></rect>
                <path d="M2 14h2"></path>
                <path d="M20 14h2"></path>
                <path d="M15 13v2"></path>
                <path d="M9 13v2"></path>
            </svg>     -->
        </div>

        <!-- Input Area -->
        <div class="px-4 sm:px-6 py-4 sm:py-5 bg-white border-t border-blue-100">
            <div id="attached-files" class="flex flex-wrap gap-2 mb-2 sm:mb-3">
                <!-- Attached files will be inserted here -->
            </div>
            
            <div class="flex gap-2 sm:gap-3 items-end">
                <input type="file" multiple accept=".pdf,.doc,.docx,.txt,image/*" id="file-input" class="hidden">
                
                <button id="file-button" class="flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-xl flex items-center justify-center transition-all duration-200">
                    <i class="fa-solid fa-plus text-base sm:text-lg"></i>
                </button>
                
                <div class="flex-1 relative min-w-0">
                    <textarea
                        id="input-textarea"
                        placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..."
                        rows="1"
                        class="w-full px-3 sm:px-5 py-2 sm:py-3 pr-8 sm:pr-12 bg-blue-50 border-2 border-blue-200 rounded-2xl focus:outline-none focus:border-blue-400 focus:bg-white resize-none transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base"
                        style="min-height: 40px; max-height: 100px;"
                    ></textarea>
                </div>
                
                <button id="send-button" class="flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-xl flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 sm:w-5 sm:h-5">
                        <line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                    </svg>
                </button>
            </div>
            
            <p class="text-xs text-gray-400 mt-2 sm:mt-3 text-center">
                Nh·∫•n Enter ƒë·ªÉ g·ª≠i ‚Ä¢ Shift + Enter ƒë·ªÉ xu·ªëng d√≤ng
            </p>
        </div>
    </div>
<!-- Th√™m v√†o cu·ªëi th·∫ª body trong index.html, tr∆∞·ªõc th·∫ª ƒë√≥ng </body> -->

  <!-- ---------------------------------------------------------------------------------------------------------- -->

<script src="App.js"></script>

<!-- Floating GeoGebra Button -->
<button id="geogebra-float-btn" 
        class="fixed bottom-20 right-4 sm:right-6 w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-blue-500 to-cyan-500 text-white rounded-full shadow-lg hover:shadow-2xl transition-all duration-300 flex items-center justify-center z-50 cursor-grab active:cursor-grabbing hover:scale-110">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 sm:w-7 sm:h-7">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="2" y1="12" x2="22" y2="12"></line>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </svg>
</button>

<!-- GeoGebra Modal -->
<div id="geogebra-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-2 sm:p-4 animate-fade-in">
    <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl w-full h-full sm:max-w-7xl sm:max-h-[95vh] sm:h-auto overflow-hidden flex flex-col border-2 border-blue-200">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between flex-shrink-0">
            <div class="flex items-center gap-2 sm:gap-3 min-w-0">
                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-white rounded-full flex items-center justify-center flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </div>
                <h2 class="text-base sm:text-xl font-bold text-white truncate">GeoGebra AI</h2>
            </div>
            <button id="close-geogebra" class="text-white hover:text-blue-100 transition-colors flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        
        <!-- Content Area -->
        <div class="flex-1 flex flex-col sm:flex-row overflow-hidden">
            <!-- AI Input Panel (Left/Top) -->
            <div class="w-full sm:w-80 bg-gradient-to-b from-blue-50 to-white border-b sm:border-b-0 sm:border-r border-blue-200 flex flex-col">
                <!-- Form Header -->
                <div class="px-3 sm:px-4 py-3 border-b border-blue-200 bg-white">
                    <h3 class="text-sm sm:text-base font-semibold text-gray-800 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500">
                            <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path>
                        </svg>
                        V·∫Ω h√¨nh t·ª± ƒë·ªông
                    </h3>
                </div>

                <!-- Input Form -->
                <div class="flex-1 overflow-y-auto p-3 sm:p-4 space-y-3">
                    <!-- Examples -->
                    <div class="bg-blue-50 rounded-lg p-3 text-xs sm:text-sm">
                        <p class="font-semibold text-blue-800 mb-2">üí° V√≠ d·ª•:</p>
                        <ul class="space-y-1 text-gray-700">
                            <li>‚Ä¢ V·∫Ω ƒë∆∞·ªùng tr√≤n t√¢m O b√°n k√≠nh 3</li>
                            <li>‚Ä¢ V·∫Ω parabol y = x¬≤ - 4x + 3</li>
                            <li>‚Ä¢ V·∫Ω tam gi√°c ABC v·ªõi A(1,2), B(3,4), C(5,1)</li>
                            <li>‚Ä¢ V·∫Ω h√†m sin(x) t·ª´ 0 ƒë·∫øn 2œÄ</li>
                        </ul>
                    </div>

                    <!-- Input Textarea -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
                            Nh·∫≠p y√™u c·∫ßu v·∫Ω h√¨nh:
                        </label>
                        <textarea 
                            id="ggb-ai-input"
                            placeholder="VD: V·∫Ω ƒë·ªì th·ªã h√†m s·ªë y = x¬≤ - 2x + 1"
                            class="w-full h-24 sm:h-32 px-3 py-2 text-sm border-2 border-blue-200 rounded-lg focus:outline-none focus:border-blue-400 resize-none"
                        ></textarea>
                    </div>

                    <!-- Draw Button -->
                    <button 
                        id="ggb-draw-btn"
                        class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold py-2.5 sm:py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2 text-sm sm:text-base"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m18 16 4-4-4-4"></path>
                            <path d="m6 8-4 4 4 4"></path>
                            <path d="m14.5 4-5 16"></path>
                        </svg>
                        <span id="draw-btn-text">V·∫Ω h√¨nh</span>
                    </button>

                    <!-- Loading Indicator -->
                    <div id="ggb-loading" class="hidden text-center py-2">
                        <div class="flex items-center justify-center gap-2 text-blue-600">
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            <span class="text-sm ml-2">ƒêang x·ª≠ l√Ω...</span>
                        </div>
                    </div>

                    <!-- Result Display -->
                    <div id="ggb-result" class="hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                            <p class="text-xs sm:text-sm font-medium text-green-800 mb-1">‚úì L·ªánh GeoGebra:</p>
                            <pre id="ggb-command" class="text-xs bg-white p-2 rounded border border-green-300 overflow-x-auto text-gray-800"></pre>
                        </div>
                    </div>

                    <!-- Error Display -->
                    <div id="ggb-error" class="hidden">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                            <p class="text-xs sm:text-sm text-red-700" id="ggb-error-text"></p>
                        </div>
                    </div>

                    <!-- Clear Button -->
                    <button 
                        id="ggb-clear-btn"
                        class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all duration-200 text-sm"
                    >
                        X√≥a t·∫•t c·∫£
                    </button>
                </div>
            </div>

            <!-- GeoGebra Container (Right/Bottom) -->
            <div class="flex-1 p-2 sm:p-4 bg-gradient-to-b from-white to-blue-50 overflow-hidden flex flex-col">
                <div id="ggb-container" class="w-full h-full min-h-[300px] sm:min-h-[500px] bg-white rounded-lg sm:rounded-xl shadow-inner border border-blue-100"></div>
            </div>
        </div>
    </div>
</div>

<script>
// GeoGebra AI Integration Script
(function() {
    const floatBtn = document.getElementById('geogebra-float-btn');
    const modal = document.getElementById('geogebra-modal');
    const closeBtn = document.getElementById('close-geogebra');
    const ggbContainer = document.getElementById('ggb-container');
    const aiInput = document.getElementById('ggb-ai-input');
    const drawBtn = document.getElementById('ggb-draw-btn');
    const drawBtnText = document.getElementById('draw-btn-text');
    const clearBtn = document.getElementById('ggb-clear-btn');
    const loading = document.getElementById('ggb-loading');
    const result = document.getElementById('ggb-result');
    const error = document.getElementById('ggb-error');
    const commandDisplay = document.getElementById('ggb-command');
    const errorText = document.getElementById('ggb-error-text');
    
    // API Configuration - S·ª≠ d·ª•ng API key t·ª´ file App.js
    const API_KEY = 'AIzaSyAt0EJWAJSp55AbEYaQpR86dqmX99byTjI';
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`;
    
    let isDragging = false;
    let currentX, currentY, initialX, initialY;
    let xOffset = 0, yOffset = 0;
    let ggbApp = null;
    let isGeoGebraLoaded = false;

    // ============ DRAGGING FUNCTIONALITY ============
    floatBtn.addEventListener('mousedown', dragStart);
    floatBtn.addEventListener('touchstart', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('touchmove', drag);
    document.addEventListener('mouseup', dragEnd);
    document.addEventListener('touchend', dragEnd);

    function dragStart(e) {
        if (e.type === 'touchstart') {
            initialX = e.touches[0].clientX - xOffset;
            initialY = e.touches[0].clientY - yOffset;
        } else {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
        }
        if (e.target === floatBtn) isDragging = true;
    }

    function drag(e) {
        if (isDragging) {
            e.preventDefault();
            if (e.type === 'touchmove') {
                currentX = e.touches[0].clientX - initialX;
                currentY = e.touches[0].clientY - initialY;
            } else {
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
            }
            xOffset = currentX;
            yOffset = currentY;
            floatBtn.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
        }
    }

    function dragEnd() {
        initialX = currentX;
        initialY = currentY;
        isDragging = false;
    }

    // ============ MODAL CONTROLS ============
    floatBtn.addEventListener('click', function() {
        if (!isDragging) {
            modal.classList.remove('hidden');
            if (!isGeoGebraLoaded) {
                loadGeoGebra();
                isGeoGebraLoaded = true;
            }
        }
    });

    closeBtn.addEventListener('click', () => modal.classList.add('hidden'));
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.add('hidden');
    });

    // ============ GEOGEBRA INITIALIZATION ============
    function loadGeoGebra() {
        if (typeof GGBApplet !== 'undefined') {
            const isMobile = window.innerWidth < 640;
            const params = {
                "appName": "classic",
                "width": ggbContainer.offsetWidth,
                "height": ggbContainer.offsetHeight - 10,
                "showToolBar": !isMobile,
                "showAlgebraInput": true,
                "showMenuBar": !isMobile,
                "enableShiftDragZoom": true,
                "showResetIcon": true,
                "enableRightClick": !isMobile,
                "errorDialogsActive": false,
                "useBrowserForJS": false,
                "allowStyleBar": true,
                "preventFocus": false,
                "language": "vi",
                "appletOnLoad": function(api) {
                    ggbApp = api;
                    console.log('GeoGebra loaded successfully');
                }
            };
            
            const applet = new GGBApplet(params, true);
            applet.inject('ggb-container');
        } else {
            ggbContainer.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><p class="text-sm">Kh√¥ng th·ªÉ t·∫£i GeoGebra</p></div>';
        }
    }

    // ============ AI PROCESSING ============
    const SYSTEM_PROMPT = `B·∫°n l√† tr·ª£ l√Ω th√¥ng minh chuy√™n v·∫Ω h√¨nh h·ªçc v·ªõi GeoGebra.

NHI·ªÜM V·ª§: 
1. Ph√¢n t√≠ch y√™u c·∫ßu ng∆∞·ªùi d√πng
2. Suy nghƒ© c√°ch v·∫Ω h·ª£p l√Ω (x√°c ƒë·ªãnh c√°c ƒëi·ªÉm, ƒë∆∞·ªùng, h√¨nh c·∫ßn thi·∫øt)
3. Chuy·ªÉn ƒë·ªïi sang l·ªánh GeoGebra ch√≠nh x√°c

QUY TR√åNH L√ÄM VI·ªÜC:
B∆∞·ªõc 1 - SUY NGHƒ® (trong <thinking>):
- Ph√¢n t√≠ch y√™u c·∫ßu: C·∫ßn v·∫Ω g√¨?
- X√°c ƒë·ªãnh c√°c th√†nh ph·∫ßn: ƒêi·ªÉm n√†o? ƒê∆∞·ªùng n√†o? H√¨nh n√†o?
- L√™n k·∫ø ho·∫°ch: V·∫Ω theo th·ª© t·ª± n√†o? C·∫ßn t√≠nh to√°n g√¨?
- Ch·ªçn t·ªça ƒë·ªô/gi√° tr·ªã h·ª£p l√Ω ƒë·ªÉ h√¨nh ƒë·∫πp, c√¢n ƒë·ªëi

B∆∞·ªõc 2 - XU·∫§T L·ªÜNH:
- Ch·ªâ tr·∫£ v·ªÅ l·ªánh GeoGebra thu·∫ßn t√∫y
- M·ªói l·ªánh m·ªôt d√≤ng
- Kh√¥ng c√≥ ch√∫ th√≠ch hay gi·∫£i th√≠ch

C√ö PH√ÅP GEOGEBRA:
# C∆° b·∫£n
- ƒêi·ªÉm: A = (1, 2)
- ƒê∆∞·ªùng th·∫≥ng qua 2 ƒëi·ªÉm: Line(A, B)
- ƒê∆∞·ªùng th·∫≥ng t·ª´ ph∆∞∆°ng tr√¨nh: f: y = 2x + 1
- ƒêo·∫°n th·∫≥ng: Segment(A, B)
- ƒê∆∞·ªùng tr√≤n: Circle((0,0), 3) ho·∫∑c Circle(A, B)
- Vector: v = Vector((1,2)) ho·∫∑c Vector(A, B)

# ƒêa gi√°c
- Tam gi√°c: Polygon(A, B, C)
- T·ª© gi√°c: Polygon(A, B, C, D)
- ƒêa gi√°c ƒë·ªÅu: RegularPolygon(A, B, 6)

# H√†m s·ªë
- Parabol: f: y = x^2 - 4x + 3
- L∆∞·ª£ng gi√°c: g: y = sin(x)
- M≈©/Log: h: y = e^x
- Ph√¢n th·ª©c: k: y = 1/x

# N√¢ng cao
- Giao ƒëi·ªÉm: E = Intersect(f, g)
- Trung ƒëi·ªÉm: M = Midpoint(A, B)
- Vu√¥ng g√≥c: PerpendicularLine(A, f)
- Song song: Line(A, Vector(f))
- Ti·∫øp tuy·∫øn: Tangent(A, c)

# M√†u s·∫Øc v√† ki·ªÉu
- SetColor(A, "Red")
- SetPointSize(A, 5)
- SetLineThickness(f, 3)

V√ç D·ª§:

Input: "V·∫Ω tam gi√°c ƒë·ªÅu"
<thinking>
C·∫ßn v·∫Ω tam gi√°c ƒë·ªÅu. Ch·ªçn c√°ch:
- ƒê·∫∑t ƒë·ªânh A, B tr√™n tr·ª•c ho√†nh c√°ch ƒë·ªÅu
- T√≠nh ƒë·ªânh C sao cho AB = BC = CA
- A = (0,0), B = (4,0), C = (2, 2‚àö3) ‚âà (2, 3.46)
</thinking>
Output:
A = (0, 0)
B = (4, 0)
C = (2, 3.46)
Polygon(A, B, C)

Input: "V·∫Ω h√¨nh vu√¥ng v√† ƒë∆∞·ªùng tr√≤n n·ªôi ti·∫øp"
<thinking>
H√¨nh vu√¥ng: 4 ƒë·ªânh c√°ch ƒë·ªÅu, t√¢m O
ƒê∆∞·ªùng tr√≤n n·ªôi ti·∫øp: t√¢m tr√πng t√¢m h√¨nh vu√¥ng, b√°n k√≠nh = c·∫°nh/2
Ch·ªçn h√¨nh vu√¥ng c·∫°nh 4, t√¢m (0,0)
C√°c ƒë·ªânh: (-2,-2), (2,-2), (2,2), (-2,2)
B√°n k√≠nh ƒë∆∞·ªùng tr√≤n: 2
</thinking>
Output:
A = (-2, -2)
B = (2, -2)
C = (2, 2)
D = (-2, 2)
Polygon(A, B, C, D)
O = (0, 0)
Circle(O, 2)

Input: "V·∫Ω ƒë·ªì th·ªã h√†m sin v√† cos tr√™n c√πng m·ªôt h·ªá tr·ª•c"
<thinking>
V·∫Ω 2 h√†m l∆∞·ª£ng gi√°c c∆° b·∫£n
D√πng m√†u kh√°c nhau ƒë·ªÉ ph√¢n bi·ªát
</thinking>
Output:
f: y = sin(x)
g: y = cos(x)
SetColor(f, "Blue")
SetColor(g, "Red")

L∆ØU √ù:
- V·ªõi y√™u c·∫ßu m∆° h·ªì, h√£y t·ª± quy·∫øt ƒë·ªãnh t·ªça ƒë·ªô/k√≠ch th∆∞·ªõc h·ª£p l√Ω
- ∆Øu ti√™n t·∫°o h√¨nh ƒë·∫πp, c√¢n ƒë·ªëi, d·ªÖ nh√¨n
- V·ªõi h√¨nh ph·ª©c t·∫°p, chia nh·ªè th√†nh c√°c b∆∞·ªõc ƒë∆°n gi·∫£n
- ƒê·∫∑t t√™n bi·∫øn c√≥ √Ω nghƒ©a: A, B, C cho ƒëi·ªÉm; f, g, h cho h√†m
- Lu√¥n b·∫Øt ƒë·∫ßu v·ªõi <thinking> ƒë·ªÉ suy nghƒ©, sau ƒë√≥ xu·∫•t l·ªánh

CH·ªà TR·∫¢ V·ªÄ: <thinking>...</thinking> sau ƒë√≥ l√† c√°c l·ªánh GeoGebra thu·∫ßn t√∫y, kh√¥ng c√≥ text th·ª´a.`;

    async function processAIRequest(userInput) {
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    system_instruction: {
                        parts: [{ text: SYSTEM_PROMPT }]
                    },
                    contents: [{
                        role: "user",
                        parts: [{ text: userInput }]
                    }]
                })
            });

            if (!response.ok) throw new Error('API request failed');

            const data = await response.json();
            const geogebraCommands = data.candidates[0].content.parts[0].text.trim();
            return geogebraCommands;
        } catch (err) {
            console.error('AI Error:', err);
            throw new Error('Kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    }

    function executeGeoGebraCommands(commands) {
        if (!ggbApp) {
            throw new Error('GeoGebra ch∆∞a s·∫µn s√†ng');
        }

        const commandLines = commands.split('\n').filter(line => line.trim());
        
        commandLines.forEach(cmd => {
            try {
                ggbApp.evalCommand(cmd.trim());
            } catch (err) {
                console.error('GeoGebra command error:', cmd, err);
            }
        });
    }

    // ============ EVENT HANDLERS ============
    drawBtn.addEventListener('click', async function() {
        const userInput = aiInput.value.trim();
        
        if (!userInput) {
            showError('Vui l√≤ng nh·∫≠p y√™u c·∫ßu v·∫Ω h√¨nh');
            return;
        }

        if (!ggbApp) {
            showError('GeoGebra ch∆∞a s·∫µn s√†ng. Vui l√≤ng ƒë·ª£i...');
            return;
        }

        // Show loading
        drawBtn.disabled = true;
        drawBtnText.textContent = 'ƒêang x·ª≠ l√Ω...';
        loading.classList.remove('hidden');
        result.classList.add('hidden');
        error.classList.add('hidden');

        try {
            // Call AI to get GeoGebra commands
            const commands = await processAIRequest(userInput);
            
            // Execute commands in GeoGebra
            executeGeoGebraCommands(commands);
            
            // Show result
            commandDisplay.textContent = commands;
            result.classList.remove('hidden');
            
        } catch (err) {
            showError(err.message);
        } finally {
            drawBtn.disabled = false;
            drawBtnText.textContent = 'V·∫Ω h√¨nh';
            loading.classList.add('hidden');
        }
    });

    clearBtn.addEventListener('click', function() {
        if (ggbApp) {
            ggbApp.reset();
        }
        aiInput.value = '';
        result.classList.add('hidden');
        error.classList.add('hidden');
    });

    // Enter to submit
    aiInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.ctrlKey) {
            drawBtn.click();
        }
    });

    function showError(message) {
        errorText.textContent = message;
        error.classList.remove('hidden');
        result.classList.add('hidden');
    }

    // ============ RESPONSIVE HANDLING ============
    window.addEventListener('resize', function() {
        if (isGeoGebraLoaded && ggbApp) {
            setTimeout(() => {
                if (ggbApp.recalculateEnvironments) {
                    ggbApp.recalculateEnvironments();
                }
            }, 100);
        }
    });
})();
</script>

<style>
#geogebra-float-btn {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

#geogebra-float-btn:active {
    transform: scale(0.95);
}

#geogebra-modal {
    backdrop-filter: blur(4px);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

#geogebra-modal:not(.hidden) > div {
    animation: fadeIn 0.3s ease-out;
}

/* Mobile optimizations */
@media (max-width: 640px) {
    #ggb-container {
        touch-action: pan-x pan-y;
    }
}
</style>
  
</body>
</html>